---
title: "Volcano Eruptions(2020_20) - TidyTuesday"
author: "[Allie Burns](https://allie-burns.github.io/)"
date: "`r Sys.Date()`"

output:
  html_document:
    toc: false
    code_folding: hide
editor_options:
  chunk_output_type: console
---


```{r setup, include=FALSE}
## Set options for knitr. Show code chunks but not warnings.
knitr::opts_chunk$set(echo = TRUE, warning = F)
```

## Loading and exploring the data

```{r prep, message=FALSE, warning=FALSE}
## Load in the libraries
library(ggplot2)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(ggpomological)
library(dplyr)

## Install tidy data
devtools::install_github("thebioengineer/tidytuesdayR")
tuesdata <- tidytuesdayR::tt_load(2020, week = 20)

## Seperate files
volcano <- tuesdata$volcano
eruptions <- tuesdata$eruptions
events <- tuesdata$events
tree_rings <- tuesdata$tree_rings

volcano

world <- ne_countries(scale = "medium", returnclass = "sf")
```

## Visualizing the data
The data this week comes from The Smithsonian Institution.

Axios put together a lovely plot of volcano eruptions since Krakatoa (after 1883) by elevation and type.

First, I want to see where volcanos are located world-wide. 

```{r volcano_maps, fig.width = 12, fig.height = 6.55}
world_volcanos <- ggplot(data = world) +
    geom_sf(fill= "antiquewhite") +
    geom_point(data = volcano, aes(x = longitude, y = latitude),
               color = "#292929", fill = "#EB5121",
               size = 2, shape = 24) +
    ggtitle("Volcanos that have erupted since 1883") +
    theme_classic() +
    theme(plot.title = element_text(hjust = 0.5, size=20),
          panel.grid.major = element_line(color = gray(.5),linetype = "dashed",size = 0.5),
          panel.background = element_rect(fill = "aliceblue",color="black"),
          axis.title.x=element_blank(),
          axis.title.y=element_blank())

world_volcanos
```

I've always known that volcanos were primarily found along fault lines but I really enjoy seeing how linear many of these volcanos really are.  I was expecting to see more volcanos in oceans but it's possible that a lot of the volcanos under water are not recorded in this dataset.

I also want to see which volcanos are located in regions where there are a lot of people. To get an idea of how the data looks. I'm mapping all of the volcanos from the previous plot. 

```{r populations around volcanos}
all_population <- ggplot(data = world) +
    geom_sf(fill= "antiquewhite") +
    geom_point(data = volcano,
               aes(x = longitude, y = latitude, fill = population_within_100_km),
               size = 2, shape = 24) +
    scale_fill_viridis_c(option = "plasma") +
    ggtitle("Volcanos that have erupted since 1883 colored bytheir surrounding populations ") +
    labs(fill = "Population\nwithin 100km") +
    theme_classic() +
    theme(plot.title = element_text(hjust = 0.5, size=20),
          panel.grid.major = element_line(color = gray(.5),linetype = "dashed",size = 0.5),
          panel.background = element_rect(fill = "aliceblue",color="black"),
          axis.title.x=element_blank(),
          axis.title.y=element_blank())

all_population

```

It's a bit busy so I'll filter out volcanos that have less than the average number of people within a 100km radius..  Then I'll map their populations within the blast zone (which in reality is usually less than 1km so this 5km likely represents people who would not immediately affected by the blast but by secondary effects).

```{r populations close to volcanos}
## Filter any volcanos that don't have any people within 100 km
volFilt <- volcano %>%
    filter(population_within_100_km > mean(population_within_100_km,na.rm=TRUE))

highest_population <- ggplot(data = world) +
    geom_sf(fill= "antiquewhite") +
    geom_point(data = volFilt,
               aes(x = longitude, y = latitude, fill = population_within_5_km),
               size = 2, shape = 24) +
    scale_fill_viridis_c(option = "plasma") +
    ggtitle("Volcanos that have erupted since 1883 colored by their surrounding populations ") +
    labs(fill = "Population\nwithin 5km") +
    theme_classic() +
    theme(plot.title = element_text(hjust = 0.5, size=20),
          panel.grid.major = element_line(color = gray(.5),linetype = "dashed",size = 0.5),
          panel.background = element_rect(fill = "aliceblue",color="black"),
          axis.title.x=element_blank(),
          axis.title.y=element_blank())

highest_population

```

```{r save, include=FALSE}
## recentFile <- as_tibble(list.files("./", ".Rmd$")) %>%
##     stringr::str_sub(1,8) %>%
##     as.numeric()

pdf(file = "../../plots/2020_20/20200512_VolcanoEruptions.pdf", width = 12, height = 7)
world_volcanos
all_population
highest_population
dev.off()

png(filename = "../../plots/2020_20/20200512_VolcanoEruptions.png", width = 600, height = 480)
world_volcanos
dev.off()
```


## Some notes about working in R markdown
In order to knit from the command line :  `R -e "rmarkdown::render('20200512_VolcanoEruptions.Rmd')" `

## Session Info
```{r session-info}
 sessionInfo()
```

